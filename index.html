<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Real-time UWB positioning visualization with MQTT connectivity">
    <meta name="keywords" content="MQTT, UWB, positioning, visualization, real-time, IoT">
    <meta name="author" content="INST Tag Visualizer Team">
    
    <title>INST Tag Visualizer v1.4</title>
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 50'%3E%3Crect width='50' height='50' rx='8' fill='%23667eea'/%3E%3Ctext x='25' y='32' text-anchor='middle' fill='white' font-family='Arial' font-size='16' font-weight='bold'%3EINST%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <svg viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="50" height="50" rx="8" fill="url(#logoGradient)"/>
                <text x="25" y="32" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="16" font-weight="bold">
                    INST
                </text>
            </svg>
        </div>
        <h1>INST Tag Visualizer v1.4</h1>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Controls Panel -->
        <section class="controls-panel">
            <!-- Connection Section -->
            <div class="control-section">
                <h3>Connection</h3>
                
                <div class="control-group">
                    <label for="brokerHost">Broker Host:</label>
                    <input type="text" id="brokerHost" value="mqtt.dynamicdevices.co.uk" 
                           placeholder="mqtt.example.com">
                </div>
                
                <div class="control-group">
                    <label for="brokerPort">Broker Port:</label>
                    <input type="number" id="brokerPort" value="8083" min="1" max="65535">
                </div>
                
                <div class="control-group">
                    <label for="topicName">Topic:</label>
                    <input type="text" id="topicName" value="inst/uwbtest1" 
                           placeholder="your/mqtt/topic">
                </div>
                
                <div class="control-group">
                    <button onclick="connectMQTT()" id="connectBtn">Connect</button>
                    <button onclick="disconnectMQTT()" id="disconnectBtn" style="display: none;">Disconnect</button>
                    <button onclick="checkConnectionStatus()" class="secondary">Check Status</button>
                    <button onclick="startSimulation()" class="secondary">Start Simulation</button>
                </div>
                
                <div class="connection-status disconnected" id="connectionStatus">
                    Disconnected
                </div>
            </div>

            <!-- Controls Section -->
            <div class="control-section">
                <h3>Controls</h3>
                
                <div class="control-group">
                    <label for="nodeSpacing">Display Scale:</label>
                    <input type="range" id="nodeSpacing" min="1" max="20" value="5" 
                           onchange="updateScale(this.value)">
                    <span id="spacingValue">5</span>
                </div>

                <div class="control-group">
                    <label for="showAccuracy">Show Accuracy:</label>
                    <input type="checkbox" id="showAccuracy" checked onchange="updateAccuracyDisplay()">
                </div>

                <div class="control-group">
                    <button onclick="toggleConsole()">Show Console</button>
                    <button onclick="manualResubscribe()" class="secondary" style="display: none;">Resubscribe</button>
                    <button onclick="clearVisualization()" class="secondary">Clear</button>
                    <button onclick="testMqttFormat()" class="secondary">Test Positioning</button>
                    <button onclick="verifyNodes()" class="secondary" style="display: none;">Verify Nodes</button>
                </div>
            </div>
        </section>

        <!-- Visualization Container -->
        <section class="visualization-container">
            <div id="visualization" role="img" aria-label="Node positioning visualization"></div>
            <div class="progress-info" id="progressInfo">
                Ready to connect. Configure broker settings above and click "Connect" for secure Eclipse Paho MQTT (SSL) or "Start Simulation" for demo data.
            </div>
        </section>

        <!-- Console Container -->
        <section class="console-container hidden" id="consoleContainer">
            <div class="console-header">
                <h3>Console Log</h3>
                <button onclick="clearConsole()" class="danger">Clear</button>
            </div>
            <div class="console-content" id="consoleContent" role="log" aria-live="polite"></div>
        </section>
    </div>

    <!-- JavaScript -->
    <script src="js/visualizer.js"></script>
    
    <!-- Analytics placeholder -->
    <script>
        // Add your analytics code here if needed
        // Example: Google Analytics, Plausible, etc.
    </script>
</body>
</html>